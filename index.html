function speak(text) {
    return new Promise((resolve, reject) => {
        if ('speechSynthesis' in window) {
            speechSynthesis.cancel(); // Pys√§yt√§ edellinen puhe
            setTimeout(() => { // Pieni viive, jotta cancel ehtii vaikuttaa
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.volume = 1.0;
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.lang = 'fi-FI';

                // Yrit√§ l√∂yt√§√§ miehen √§√§ni Timolle
                const voices = speechSynthesis.getVoices();
                const maleVoice = voices.find(voice =>
                    voice.lang.includes('fi') &&
                    (voice.name.toLowerCase().includes('male') ||
                     voice.name.toLowerCase().includes('mies') ||
                     voice.name.toLowerCase().includes('finnish') && !voice.name.toLowerCase().includes('female'))
                );
                if (maleVoice) {
                    utterance.voice = maleVoice;
                } else {
                    console.warn('‚ö†Ô∏è Miehen √§√§nt√§ ei l√∂ytynyt suomen kielelle (Timo). K√§ytet√§√§n oletus√§√§nt√§.');
                }

                utterance.onend = () => {
                    resolve();
                };
                utterance.onerror = (e) => {
                    console.error('Puhevihre (ty√∂p√∂yt√§):', e);
                    reject(e);
                };

                console.log('üéµ Ty√∂p√∂yt√§puhe:', text.substring(0, 30) + '...');
                speechSynthesis.speak(utterance);
            }, 100);
        } else {
            console.warn('SpeechSynthesis ei tuettu.');
            resolve(); // Jatka vaikka puhe ei toimi
        }
    });
}